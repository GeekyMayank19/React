<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="script.css" />
    <!-- <script src="userProfile.js"></script> -->
    <title>Profile_page</title>
  </head>
  <body>
    <div class="container">
      <button onclick="Logout();" style="float: right" class="btn btn-danger">
        Logout
      </button>
      <h3>Welcome</h3>
      <h3 style="color: rgb(138, 14, 14)">
        <script>
          document.write(localStorage.getItem("fname"));
        </script>
      </h3>
      <form action="action_page.php">
        <div class="row">
          <div class="col-25">
            <label for="vnum">Vehicle Number</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="vnum"
              placeholder="12 digit Vehicle Number"
            />
          </div>
        </div>
        <!-- ------------------- -->
        <div class="row">
          <div class="col-25">
            <label for="vtype">Vehicle Type</label>
          </div>
          <div class="col-75">
            <select id="vtype">
              <option value="select">Select</option>
              <option value="car">Car</option>
              <option value="bus">Bus</option>
              <option value="truck">Truck</option>
            </select>
          </div>
        </div>
        <!-- ---------------------------- -->

        <div class="row">
          <div class="col-25">
            <label for="price">Price</label>
          </div>
          <div class="col-75">
            <input
              type="number"
              id="price"
              placeholder="in indian rupees"
              autocomplete="off"
            />
          </div>
        </div>
        <!-- --------------------- -->
        <div class="row">
          <div class="col-25">
            <label for="date">date</label>
          </div>
          <div class="col-75">
            <input
              type="date"
              id="date"
              placeholder="in indian rupees"
              autocomplete="off"
            />
          </div>
        </div>
        <!-- ------------------------------------------ -->
        <div class="row">
          <input
            type="button"
            value="Submit"
            class="btn btn-danger my-4"
            onclick="saveData()"
          />
        </div>
      </form>

      <!-- Button trigger modal -->
      <button
        type="button"
        class="btn btn-primary"
        data-toggle="modal"
        data-target="#exampleModal"
      >
        view details
      </button>
      <br />
      <!-- Modal -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">User Detail</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <h3 style="color: rgb(138, 14, 14)">
                Firstname:
                <script>
                  document.write(localStorage.getItem("fname"));
                </script>
              </h3>
              <h3 style="color: rgb(138, 14, 14)">
                Lastname
                <script>
                  document.write(localStorage.getItem("lname"));
                </script>
              </h3>
              <h3 style="color: rgb(138, 14, 14)">
                Email:
                <script>
                  document.write(localStorage.getItem("email"));
                </script>
              </h3>
              <h3 style="color: rgb(138, 14, 14)">
                Password:
                <script>
                  document.write(localStorage.getItem("password"));
                </script>
              </h3>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Close
              </button>
              <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
            </div>
          </div>
        </div>
      </div>
      <hr />
      <br />
      <div class="employees-table">
        <table class="table table-dark list" id="showuser">
          <thead>
            <tr>
              <th scope="col">vehicle_number</th>
              <th scope="col">vehicle_type</th>
              <th scope="col">price</th>
              <th scope="col">date</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
  </body>
  <script>


    

    let log_email = localStorage.getItem("email")
      ? localStorage.getItem("email")
      : "";
    // console.log(fname);
    if (log_email == "") {
      alert("U need to login first");
      window.location.href = "userLogin.html";
    }
    function Logout() {
      localStorage.removeItem("name");
      localStorage.removeItem("email");
      window.location.href = "userLogin.html";
    }


    let users = JSON.parse(localStorage.getItem("users"))
    let email = (localStorage.getItem("email"));
    let current_user = users.find((user)=>user.email === email );
    let idx;
    for(let i = 0;i<users.length;i++){
      if(users[i].email === email ){
        idx = i;
      }
    }
  

var table = document.getElementById("showuser").innerHTML;
    function saveData(){
      let vehicle_record ;

      if(current_user.hasOwnProperty("vehicle_record")){
        vehicle_record = current_user.vehicle_record;
      }else{
        vehicle_record= [];
      }
      // let vnum = document.getElementById("vnum").value;
      // let vtype = document.getElementById("vtype").value;
      // let price = document.getElementById("price").value;
      // let date = document.getElementById("date").value;
      
     let  vehicle_record_obj = {
        "vnum":document.getElementById("vnum").value,
        "vtype":document.getElementById("vtype").value,
        "price":document.getElementById("price").value,
        "date":document.getElementById("date").value,
      }

      vehicle_record.push(vehicle_record_obj);
      
      current_user.vehicle_record = vehicle_record;
      users[idx] = current_user;
      if(document.getElementById("vnum").value!==""){
        localStorage.setItem("users",JSON.stringify(users));   
      }
       
      location.reload();
    }
    let vehicleR = users[idx].vehicle_record;
    console.log(vehicleR[0].vnum);
     var showData = ""
    for(let i = 0;i<vehicleR.length;i++){
         
        showData += `<tr>
        <td>${vehicleR[i].vnum}</td>
        <td>${vehicleR[i].vtype}</td>
        <td>${vehicleR[i].price}</td>
        <td>${vehicleR[i].date}</td>
        </tr>`;
    }
        var table = document.getElementById("showuser").innerHTML;
        table += showData;
        document.getElementById("showuser").innerHTML = table;

  </script>
</html>
